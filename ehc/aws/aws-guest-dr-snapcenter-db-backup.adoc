---
sidebar: sidebar 
permalink: ehc/aws/aws-guest-dr-snapcenter-db-backup.html 
keywords: SnapCenter backup, restore process, Swagger, authorization token, NFS, CIFS, file share, XCOPY utility 
summary: 支援基礎MySQL資料庫及組態資料的備份與還原、以便在發生災難時恢復該伺服器。SnapCenter SnapCenter就我們的解決方案而言、我們在SnapCenter VPC內的AWS EC2執行個體上恢復了該資料庫和組態。 
---
= 適用於災難恢復的資料庫備份SnapCenter
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../../media/


link:aws-guest-dr-cloud-backup-config.html["先前版本：雲端備份工具與組態。"]

支援基礎MySQL資料庫及組態資料的備份與還原、以便在發生災難時恢復該伺服器。SnapCenter SnapCenter就我們的解決方案而言、我們在SnapCenter VPC內的AWS EC2執行個體上恢復了該資料庫和組態。如需此步驟的詳細資訊、請參閱 https://docs.netapp.com/us-en/snapcenter/sc-automation/rest_api_workflows_disaster_recovery_of_snapcenter_server.html["此連結"^]。



== 支援需求SnapCenter

下列先決條件是SnapCenter 進行資訊備份所需的條件：

* 在內部部署ONTAP 的支援系統上建立一個Volume和SMB共用區、以找出備份的資料庫和組態檔案。
* 內部部署ONTAP 的SnapMirror系統與AWS帳戶中的FSX或CVO之間的SnapMirror關係。此關係用於傳輸包含備份SnapCenter 的還原資料庫和組態檔案的快照。
* 安裝在雲端帳戶的Windows Server、可安裝在EC2執行個體或VMware Cloud SDDC的VM上。
* 安裝在Windows EC2執行個體或VMware Cloud VM上的SnapCenter




== 支援備份與還原程序摘要SnapCenter

* 在內部部署ONTAP 的內部系統上建立一個磁碟區、以裝載備份資料庫和組態檔案。
* 在內部部署與FSx/CVO之間建立SnapMirror關係。
* 掛載SMB共用區。
* 擷取Swagger授權權杖以執行API工作。
* 啟動資料庫還原程序。
* 使用xcopy公用程式將資料庫和組態檔案本機目錄複製到SMB共用區。
* 在FSX上、建立ONTAP 一個Clone of the Sf2 Volume（透過內部部署的SnapMirror複製）。
* 將SMB共用區從FSX掛載至EC2/VMware Cloud。
* 將還原目錄從SMB共用複製到本機目錄。
* 從Swagger執行SQL Server還原程序。




== 備份SnapCenter 還原資料庫與組態

支援執行REST API命令的Web用戶端介面。SnapCenter如需透過Swagger存取REST API的相關資訊、請參閱SnapCenter 上的《》文件 https://docs.netapp.com/us-en/snapcenter/sc-automation/overview_rest_apis.html["此連結"^]。



=== 登入Swagger並取得授權權杖

瀏覽至Swagger頁面後、您必須擷取授權權杖、才能啟動資料庫還原程序。

. 請至SnapCenter https://<SnapCenter伺服器IP：8146/swagger/_存取《Seswagger API》網頁。
+
image:dr-vmc-aws-image40.png["錯誤：缺少圖形影像"]

. 展開「驗證」區段、然後按一下「試用」。
+
image:dr-vmc-aws-image41.png["錯誤：缺少圖形影像"]

. 在UserOperationConttext區域中、填入SnapCenter 「資訊」認證和角色、然後按一下「執行」。
+
image:dr-vmc-aws-image42.png["錯誤：缺少圖形影像"]

. 在下方的「回應」本文中、您可以看到權杖。執行備份程序時、請複製權杖文字以進行驗證。
+
image:dr-vmc-aws-image43.png["錯誤：缺少圖形影像"]





=== 執行SnapCenter 資料庫的還原備份

接下來前往Swagger頁面上的Disaster Recovery區域、開始SnapCenter 執行VMware還原程序。

. 按一下「Disaster Recovery（災難恢復）」區域即可展開。
+
image:dr-vmc-aws-image44.png["錯誤：缺少圖形影像"]

. 展開「/4.6/dissterrecovery /server/Backup」區段、然後按一下「Try it out（試用）」。
+
image:dr-vmc-aws-image45.png["錯誤：缺少圖形影像"]

. 在「SmDRBackup Request」區段中、新增正確的本機目標路徑、然後選取「執行」以開始SnapCenter 備份整個過程中的資料庫和組態。
+

NOTE: 備份程序不允許直接備份到NFS或CIFS檔案共用區。

+
image:dr-vmc-aws-image46.png["錯誤：缺少圖形影像"]





=== 從SnapCenter 無法監控備份工作

登入SnapCenter 功能以在開始資料庫還原程序時檢閱記錄檔。在「Monitor（監控）」區段下、您可以檢視SnapCenter 有關支援伺服器災難恢復備份的詳細資料。

image:dr-vmc-aws-image47.png["錯誤：缺少圖形影像"]



=== 使用XCOPY公用程式將資料庫備份檔案複製到SMB共用區

接下來、您必須將備份從SnapCenter 位於支援服務器上的本機磁碟機移至CIFS共用區、以便SnapMirror將資料複製到位於AWS FSX執行個體上的次要位置。使用xcopy搭配保留檔案權限的特定選項。

以系統管理員身分開啟命令提示字元。在命令提示字元中輸入下列命令：

....
xcopy  <Source_Path>  \\<Destination_Server_IP>\<Folder_Path> /O /X /E /H /K
xcopy c:\SC_Backups\SnapCenter_DR \\10.61.181.185\snapcenter_dr /O /X /E /H /K
....
link:aws-guest-dr-failover.html["下一步：容錯移轉。"]
