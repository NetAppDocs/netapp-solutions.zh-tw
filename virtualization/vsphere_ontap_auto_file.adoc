---
sidebar: sidebar 
permalink: virtualization/vsphere_ontap_auto_file.html 
keywords: vSphere, NFS, NFS4.1, NAS, ONTAP tools, VLAN, network interface 
summary: 本頁提供VMware vSphere環境中的NFS資料存放區支援。 
---
= vSphere傳統檔案儲存資源配置ONTAP 功能、搭配使用
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/
:scriptsdir: ./../scripts/
:author: Suresh Thoppay, TME - Hybrid Cloud Solutions
:firstname: Suresh
:authorinitials: STT
:middlename: Thoppay,
:lastname: TME - Hybrid Cloud Solutions
:authors: Suresh Thoppay, TME - Hybrid Cloud Solutions


VMware vSphere支援下列NFS傳輸協定、兩者都支援ONTAP VMware。

* link:vsphere_ontap_auto_file_nfs.html["NFS版本3"]
* link:vsphere_ontap_auto_file_nfs41.html["NFS 4.1版"]


如果您需要協助選取vSphere的正確NFS版本、請檢查 link:++https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.storage.doc/GUID-8A929FE4-1207-4CC5-A086-7016D73C328F.html++["NFS用戶端版本的比較"]。

vSphere可讓客戶使用企業級NFS陣列、同時存取ESXi叢集中所有節點的資料存放區。如資料存放區一節所述、在使用NFS搭配vSphere時、會有一些易於使用和儲存效率可見度的優點。

搭配ONTAP vSphere使用VMware NFS時、建議採用下列最佳實務做法：

* 在叢集中的每個節點上、為每個SVM使用單一邏輯介面（LIF）ONTAP 。不再需要過去針對每個資料存放區的LIF建議。雖然直接存取（LIF和資料存放區位於同一個節點）是最佳選擇、但請勿擔心間接存取、因為效能影響通常很小（微秒）。
* VMware自VMware Infrastructure 3以來就一直支援NFSv3。vSphere 6.0新增對NFSv4.1的支援、可啟用某些進階功能、例如Kerberos安全性。NFSv3使用用戶端鎖定功能時、NFSv4.1會使用伺服器端鎖定功能。雖然可以透過這兩種傳輸協定匯出一個資料區、但ESXi只能透過一個傳輸協定掛載。ONTAP此單一傳輸協定掛載並不排除其他ESXi主機透過不同版本掛載相同的資料存放區。請務必指定要在掛載時使用的傳輸協定版本、以便所有主機使用相同版本、因此鎖定樣式相同。請勿在主機之間混合使用NFS版本。如有可能、請使用主機設定檔檢查是否符合規定。
+
** 由於NFSv3與NFSv4.1之間沒有自動資料存放區轉換、因此請建立新的NFSv4.1資料存放區、並使用Storage VMotion將VM移轉至新的資料存放區。
** 請參閱中的NFS v4.1互通性表附註 https://mysupport.netapp.com/matrix/["NetApp互通性對照表工具"^] 支援所需的特定ESXi修補程式層級。


* NFS匯出原則用於控制vSphere主機的存取。您可以將一個原則與多個磁碟區（資料存放區）搭配使用。使用NFSv3時、ESXi會使用sys（UNIX）安全樣式、並需要root掛載選項來執行VM。在現階段、此選項稱為超級使用者、使用超級使用者選項時、不需要指定匿名使用者ID。ONTAP請注意、針對「-anon」和「-allow-suid」使用不同值的匯出原則規則、可能會導致SVM探索問題ONTAP 。以下是原則範例：
+
** 存取傳輸協定：nfs3
** 用戶端配對規格：192．168．42．21
** RO存取規則：系統
** RW存取規則：系統
** 匿名UID：
** 超級使用者：sys


* 如果使用適用於VMware VAAI的NetApp NFS外掛程式、則在建立或修改匯出原則規則時、該傳輸協定應設為「NFS」。VAAI複本卸載作業需要NFSv4傳輸協定、而將傳輸協定指定為「NFS」會自動同時包含NFSv3和NFSv3版本。
* NFS資料存放區磁碟區是從SVM的根磁碟區連結而來、因此ESXi也必須能夠存取根磁碟區、才能瀏覽及掛載資料存放區磁碟區。根磁碟區和資料存放區磁碟區連接的任何其他磁碟區的匯出原則、必須包含ESXi伺服器授予其唯讀存取權的規則或規則。以下是根磁碟區的原則範例、也使用VAAI外掛程式：
+
** 存取傳輸協定：NFS（包括nfs3和nfs4）
** 用戶端配對規格192．168．42．21
** RO存取規則。系統
** RW存取規則。Never（root Volume的最佳安全性）
** 匿名UID：
** 超級使用者：sys（也適用於採用VAAI的根Volume）


* 使用ONTAP VMware vSphere的VMware Infrastructure（最重要的最佳實務做法）：
+
** 使用VMware vSphere的VMware VMware VMware vSphere功能來配置資料存放區、因為它能自動簡化匯出原則的管理。ONTAP
** 使用外掛程式為VMware叢集建立資料存放區時、請選取叢集而非單一ESX伺服器。此選項會觸發IT自動將資料存放區掛載至叢集中的所有主機。
** 使用外掛程式掛載功能、將現有的資料存放區套用至新的伺服器。
** 如果不使用ONTAP VMware vSphere的VMware vSphere功能、請針對所有伺服器或需要額外存取控制的每個伺服器叢集、使用單一匯出原則。


* 雖然供應彈性的Volume命名空間結構、可利用交會在樹狀結構中排列磁碟區、但這種方法對vSphere沒有任何價值。ONTAP無論儲存設備的命名空間階層為何、它都會在資料存放區根目錄中為每個VM建立一個目錄。因此、最佳實務做法是將vSphere磁碟區的交會路徑掛載到SVM的根磁碟區、這就是ONTAP VMware vSphere的VMware vSphere功能如何配置資料存放區。沒有巢狀結點路徑也表示除了根磁碟區之外、沒有任何磁碟區相依於任何磁碟區、即使是刻意將磁碟區離線或銷毀、也不會影響其他磁碟區的路徑。
* 對於NFS資料存放區上的NTFS分割區、4K區塊大小是可以的。下圖說明從vSphere主機連線至ONTAP VMware NFS資料存放區的能力。


image:vsphere_ontap_image3.png["錯誤：缺少圖形影像"]

下表列出NFS版本及支援的功能。

|===
| vSphere功能 | NFSv3 | NFSv4.1 


| vMotion與Storage vMotion | 是的 | 是的 


| 高可用度 | 是的 | 是的 


| 容錯能力 | 是的 | 是的 


| DRS | 是的 | 是的 


| 主機設定檔 | 是的 | 是的 


| 儲存DRS | 是的 | 否 


| 儲存I/O控制 | 是的 | 否 


| SRM | 是的 | 否 


| 虛擬磁碟區 | 是的 | 否 


| 硬體加速（VAAI） | 是的 | 是（vSphere 6.5及更新版本、NetApp VAAI外掛程式1.1.2） 


| Kerberos驗證 | 否 | 是（vSphere 6.5及更新版本增強支援AES、krb5i） 


| 多重路徑支援 | 否 | 否（ESXi 6.5及更新版本透過工作階段主幹支援；ONTAP 支援透過pNFS提供支援） 
|===